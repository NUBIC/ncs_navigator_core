.page_section
  = form_for(@contact_link) do |f| 
    = render "shared/full_error_messages", :object => f.object
    
    = f.hidden_field :person_id
    
    .contact_link_section
      %h3
        Contact
      = fields_for @contact_link.contact do |contact|
        = render "contacts/form_fields", { :f => contact }
    
    .contact_link_section
      %h3
        Event
      = fields_for @contact_link.event do |event|
        = render "events/form_fields", { :f => event }
        
    - if @contact_link.instrument.blank?
      .contact_link_section
        %h3
          Instrument
        %p
          No Instrument exists for the current event - 
          = @contact_link.event
    - else
      .contact_link_section
        %h3
          Instrument
        - if @contact_link.instrument.survey
          - survey = @contact_link.instrument.survey
          - if rs = ResponseSet.where(:survey_id => survey.id).where(:user_id => @contact_link.person_id).first
            .survey
              = link_to survey.title, edit_my_survey_path(:survey_code => survey.access_code, :response_set_code => rs.access_code), :class => "show_link icon_link"
      
        = fields_for @contact_link.instrument do |instrument|
          = render "instruments/form_fields", { :f => instrument }
      
    %p
      = f.submit "Submit", :disable_with => 'Submitting...'