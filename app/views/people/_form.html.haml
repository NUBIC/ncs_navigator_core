%h3
  = @person.to_s
  
.page_section
  - if @person.participant?
    #edit_participant_link
      = link_to "Edit Participant Record", edit_participant_path(@person.participant), :class => "edit_link icon_link"
  - else
    #create_participant_link
      = link_to "Create Participant Record", new_participant_path(:person_id => @person.id), :class => "edit_link icon_link"
  = form_for(@person) do |f| 
    = render "shared/full_error_messages", :object => f.object

    = render "shared/ncs_code_select", { :f => f, :code => :psu_code, :label_text => "PSU", :default_value => @psu_code }
    
    = render "shared/ncs_code_select", { :f => f, :code => :prefix_code, :label_text => "Prefix" }
    
    %p
      = f.label :first_name, "First Name"
      %br
      = f.text_field :first_name

    %p
      = f.label :middle_name, "Middle Name"
      %br
      = f.text_field :middle_name

    %p
      = f.label :last_name, "Last Name"
      %br
      = f.text_field :last_name

    %p
      = f.label :maiden_name, "Maiden Name"
      %br
      = f.text_field :maiden_name
      
    = render "shared/ncs_code_select", { :f => f, :code => :suffix_code, :label_text => "Suffix" }
    
    %p
      = f.label :title, "Title"
      %br
      = f.text_field :title
    
    = render "shared/ncs_code_select", { :f => f, :code => :sex_code, :label_text => "Sex" }
    
    %p
      = f.label :age, "Age"
      %br
      = f.text_field :age
      
    = render "shared/ncs_code_select", { :f => f, :code => :age_range_code, :label_text => "Age Range" }

    %p
      = f.label :person_dob_date, "Date Of Birth"
      %br
      = f.text_field :person_dob_date, :class => "datepicker"
      = f.label :person_dob_modifier_refused, "Refused"
      = f.radio_button :person_dob_modifier, :refused
      = f.label :person_dob_modifier_unknown, "Unknown"
      = f.radio_button :person_dob_modifier, :unknown

    = render "shared/ncs_code_select", { :f => f, :code => :deceased_code, :label_text => "Deceased" }

    = render "shared/ncs_code_select", { :f => f, :code => :ethnic_group_code, :label_text => "Ethnic Group" }

    = render "shared/ncs_code_select", { :f => f, :code => :language_code, :label_text => "Language", :other => :language_other }

    = render "shared/ncs_code_select", { :f => f, :code => :marital_status_code, :label_text => "Marital Status", :other => :marital_status_other }
    
    = render "shared/ncs_code_select", { :f => f, :code => :preferred_contact_method_code, :label_text => "Preferred Contact Method", :other => :preferred_contact_method_other }

    = render "shared/ncs_code_select", { :f => f, :code => :planned_move_code, :label_text => "Planned Move" }

    = render "shared/ncs_code_select", { :f => f, :code => :move_info_code, :label_text => "Move Info" }

    = render "shared/ncs_code_select", { :f => f, :code => :when_move_code, :label_text => "When Move" }

    %p
      = f.label :date_move_date, "Moving Date"
      %br
      = f.text_field :date_move_date, :class => "datepicker"
      = f.label :date_move_modifier_refused, "Refused"
      = f.radio_button :date_move_modifier, :refused
      = f.label :date_move_modifier_unknown, "Unknown"
      = f.radio_button :date_move_modifier, :unknown
      = f.label :date_move_modifier_not_applicable, "Not Applicable"
      = f.radio_button :date_move_modifier, :not_applicable

    = render "shared/ncs_code_select", { :f => f, :code => :p_tracing_code, :label_text => "Tracing" }
    
    = render "shared/ncs_code_select", { :f => f, :code => :p_info_source_code, :label_text => "Info Source", :other => :p_info_source_other }

    %p
      = f.label :p_info_date, "Info Date"
      %br
      = f.text_field :p_info_date, :class => "datepicker"
      
    %p
      = f.label :p_info_update, "Info Update"
      %br
      = f.text_field :p_info_update, :class => "datepicker"

    %p
      = f.label :person_comment, "Comment"
      %br
      = f.text_area :person_comment
      
    %p
      = f.submit "Submit", :disable_with => 'Submitting...'

.links
  = link_to "All People", people_path, :class => "list_link icon_link"
  
:javascript
  // For the 'other' field
  // Check on pageload
  $(document).ready(function() {
    $(".datepicker").datepicker();
    
    wire_up_select_other("#person_language_code","#person_language_other");
    wire_up_select_other("#person_marital_status_code","#person_marital_status_other");
    wire_up_select_other("#person_preferred_contact_method_code","#person_preferred_contact_method_other");
    wire_up_select_other("#person_p_info_source_code","#person_p_info_source_other");
  });