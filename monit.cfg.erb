<% PID_FILE = File.join(pwd, 'tmp', 'pids', 'sidekiq.pid') %>

<% 
  env = [] << "RAILS_ENV=#{rails_env}" unless rails_env.blank?
  cd = "cd #{pwd}"
  sidekiq = "bundle exec sidekiq -P #{PID_FILE}"
  command = [env, cd, sidekiq].flatten.join(' && ')
%>

check process sidekiq
  with pidfile <%= PID_FILE %>
  start program = "/bin/bash -c '<%= command %>'" with timeout 90 seconds
  stop program = "/bin/bash -c 'kill -s TERM `cat <%= PID_FILE %>`'" with timeout 90 seconds
  group ncs_navigator_core