<% PWD = ENV["PWD"] %>
<% PID_FILE = File.join(PWD, 'tmp', 'pids', 'sidekiq.pid') %>

<% 
  ADDITIONAL = ''
  if ENV['RVM']
    ADDITIONAL = "export PATH=#{ENV['PATH']} && export GEM_HOME=#{ENV['GEM_HOME']} && export GEM_PATH=#{ENV['GEM_PATH']} && export HOME=#{ENV['HOME']} && "
  end
%>

check process sidekiq
  with pidfile <%= PID_FILE %>
  start program = "/bin/bash -c '<%= ADDITIONAL %> cd <%= PWD %> && sidekiq -P <%= PID_FILE %>'" with timeout 90 seconds
  stop program = "/bin/bash -c 'kill -s TERM `cat <%= PID_FILE %>`'" with timeout 90 seconds
  group ncs_navigator_core